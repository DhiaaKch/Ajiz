# Explication du Projet Ajiz (Interface Locale pour CS Academy)

Ce document explique le fonctionnement de chaque partie du site, du backend (serveur) au frontend (interface utilisateur) et l'int√©gration avec l'API CS Academy.

## 1. Vue d'ensemble

Le projet est une application web locale qui permet d'√©crire, tester ("Run") et soumettre ("Submit") du code sur CS Academy sans utiliser leur interface web. Il agit comme un **proxy** :
*   Le frontend envoie les requ√™tes √† votre serveur local.
*   Le serveur local communique avec CS Academy via leur API et WebSocket.

---

## 2. Backend (`server.py`)

Le backend est √©crit en Python avec le framework **Flask**. Il g√®re deux t√¢ches principales : servir l'interface web et communiquer avec CS Academy.

### Fonctionnalit√©s Cl√©s :

1.  **Serveur Web (Flask)** :
    *   Sert les fichiers statiques (`index.html`, `style.css`, `script.js`) depuis le dossier `public/`.
    *   Expose deux API pour le frontend : `/api/run` et `/api/submit`.

2.  **Connexion WebSocket (`start_websocket`)** :
    *   Code une connexion persistante avec `wss://ws3.csacademy.com/`.
    *   S'ex√©cute dans un **thread s√©par√©** pour ne pas bloquer le serveur Flask.
    *   **Abonnement (`on_open`)** : Envoie des messages `s ...` pour s'abonner aux canaux d'√©v√©nements (global et session utilisateur). C'est crucial pour recevoir les r√©sultats des tests.
    *   **Gestion des Messages (`on_message`)** :
        *   Analyse les messages re√ßus de CS Academy.
        *   D√©tecte les r√©sultats de tests (`runResults`) et les statuts de soumission (`finished`, `test_results`).
        *   Stocke ces r√©sultats dans un cache global (`RESULTS_CACHE`).

3.  **API `/api/run`** :
    *   Re√ßoit le code et l'entr√©e utilisateur.
    *   Envoie une requ√™te `POST` √† `https://csacademy.com/eval/submit_custom_run/`.
    *   Attend (polling) que le r√©sultat apparaisse dans `RESULTS_CACHE` (rempli par le WebSocket).
    *   Renvoie le r√©sultat (sortie standard/erreur) au frontend.

4.  **API `/api/submit`** :
    *   Re√ßoit le code source.
    *   Envoie une requ√™te `POST` √† `https://csacademy.com/eval/submit_evaljob/`.
    *   Attend que le WebSocket re√ßoive l'√©v√©nement `finished` ou `done`.
    *   Renvoie le score final et les d√©tails des tests au frontend.

---

## 3. Frontend (`public/`)

### `index.html`
*   La structure de la page.
*   Utilise `CodeMirror` (version locale) pour offrir un √©diteur de code avec coloration syntaxique.
*   Contient les boutons "Run" et "Submit", ainsi que les zones pour l'entr√©e (`Input`) et la sortie (`Output`).

### `script.js`
Ce fichier contient la logique c√¥t√© client :
1.  **Initialisation** : Configure l'√©diteur CodeMirror.
2.  **Bouton "Run"** :
    *   R√©cup√®re le code de l'√©diteur.
    *   Envoie une requ√™te `POST /api/run` au serveur local.
    *   Affiche la r√©ponse : si succ√®s, affiche la sortie (`stdout`) ; si erreur, affiche l'erreur (`stderr`).
    *   *Note* : Concat√®ne la sortie standard et l'erreur pour une lecture facile sans wrapper.
3.  **Bouton "Submit"** :
    *   Envoie une requ√™te `POST /api/submit`.
    *   Affiche le score retourn√© par le serveur (ex: "Score: 100").
    *   Affiche "Submission Received" si le serveur met trop de temps √† r√©pondre (timeout).

### `style.css`
*   D√©finit le th√®me sombre ("Dark Mode") et la mise en page responsive.
*   Style premium pour les boutons (d√©grad√©s, hover effects) et l'√©diteur.

---

## 4. Int√©gration API & WebSocket

Le syst√®me repose sur l'imitation du comportement du navigateur sur le site CS Academy.

*   **Authentification** : Utilise les cookies (`csrftoken`, `crossSessionId`) et l'ID de session d√©finis dans `server.py`. Ces informations doivent √™tre mises √† jour si la session expire.
*   **Protocole WebSocket** :
    *   Les messages envoy√©s sont au format `s {channel} {length+2}`.
    *   Les messages re√ßus sont pars√©s pour extraire les objets JSON imbriqu√©s.
*   **Endpoints** :
    *   `submit_custom_run` : Pour l'ex√©cution rapide avec entr√©e personnalis√©e.
    *   `submit_evaljob` : Pour la soumission officielle qui compte pour le score.

---

## R√©sum√© du Flux

1.  **Utilisateur** clique sur "Run".
2.  **Frontend** -> `POST /api/run` -> **Backend**.
3.  **Backend** -> `POST CS Academy API` -> R√©cup√®re `customRunId`.
4.  **Backend** attend.
5.  **CS Academy** -> Envoie r√©sultat via **WebSocket**.
6.  **Backend** (Thread WS) -> Re√ßoit le message -> Met √† jour `RESULTS_CACHE`.
7.  **Backend** (Route API) -> Voit le r√©sultat dans le cache -> Renvoie au **Frontend**.
8.  **Frontend** affiche le r√©sultat.

---

# üë∂ Explication Pour Un Enfant (Le Walkie-Talkie)

Imagine que tu es dans un grand jeu de cache-cache avec CS Academy.

### 1. Le WebSocket (Le T√©l√©phone)
C'est comme si tu avais un **t√©l√©phone ouvert en ligne directe** avec le juge du jeu (CS Academy). Tu ne raccroches jamais, tu restes toujours au bout du fil pour entendre ce qu'il dit.

### 2. L'Abonnement (`on_open`) (Choisir la Cha√Æne) de Talkie-Walkie
Imagine que ce t√©l√©phone est un Talkie-Walkie avec plein de cha√Ænes :
*   Canal 1 : Les news de tout le monde.
*   Canal 221818 : **Tes r√©sultats personnels**.

Quand tu allumes ton Talkie-Walkie (`on_open`), tu dois dire : **"All√¥, je veux √©couter le Canal 221818 !"**.
Si le serveur n'avait pas cette consigne, il parlerait dans le vide sur le mauvais canal, et tu n'entendrais jamais ton r√©sultat. C'est √ßa, "l'Abonnement" (`subscribe`).

### 3. La Gestion des Messages (`on_message`) (L'Ardoise Magique)
Une fois que tu √©coutes le bon canal :
*   Le juge dit : "H√©, pour le devoir #149, tu as eu 100/100 !".
*   Toi, tu as une **Ardoise Magique** (le Cache `RESULTS_CACHE`).
*   D√®s que tu entends le r√©sultat, tu l'√©cris vite sur l'ardoise : "Devoir #149 = 100/100".

Pendant ce temps, ton ami (le bouton "Submit" du site) te demande toutes les secondes : "Alors ? Alors ?".
D√®s que tu as √©crit le r√©sultat sur l'ardoise, tu lui r√©ponds : "C'est bon, j'ai eu 100 !".

**R√©sum√© :**
1.  Tu appelles le juge (**WebSocket**).
2.  Tu lui dis "Parle-moi sur MA fr√©quence" (**Abonnement**).
3.  Quand il parle, tu notes la note sur un tableau (**Message Handling / Cache**).
